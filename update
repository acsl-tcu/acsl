#!/usr/bin/env bash

if [ $# -eq 1 ];then

version=$1
sed -i "s/Version: [0-9]\+\.[0-9]\+/Version: ${version}/" ./Debian/DEBIAN/control
sed -i "s/v[0-9]\+\.[0-9]\+/v${version}/g" ./README.md
sed -i "s/acsl_[0-9]\+\.[0-9]\+_all.deb/acsl_${version}_all.deb/g" ./README.md
cat ./Debian/DEBIAN/control
git pull
rm -f acsl_*_all.deb
rm -f Debian/usr/bin/acsl
{
  echo '#!/usr/bin/env bash'
  echo "man $@" >>Debian/usr/bin/acsl
  for f in src/*; do
    sed '1{/^#!\/.*sh$/d}' "$f"
  done
} >Debian/usr/bin/acsl

cd Debian
md5sum usr/bin/acsl | tee DEBIAN/md5sums
cd ..
fakeroot dpkg-deb --build Debian .
sudo dpkg -i acsl_${version}_all.deb

tmp=gh repo list acsl-tcu | grep project | fmt | awk '{print $1}' | sed -e "s|acsl-tcu/project
_||g"
sed -i "s|PROJECT_LIST|$tmp|g" acsl.bash
git add .
git commit -m "update acsl command"
git push


echo https://github.com/acsl-tcu/acsl/releases/edit/v${version}
explorer.exe .
else
  echo "version is required: example ./update 2.1"
fi
